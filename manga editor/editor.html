<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Manga Editor v2.1 - Fix</title>
    <style>
        /* CSS BURADA */
        body { font-family: 'Segoe UI', sans-serif; background: #2c3e50; margin: 0; display: flex; flex-direction: column; align-items: center; }
        .toolbar { 
            background: #ecf0f1; padding: 10px 20px; width: 100%; display: flex; 
            justify-content: center; gap: 20px; position: sticky; top: 0; z-index: 100;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); align-items: center;
        }
        .group { display: flex; align-items: center; gap: 10px; border-right: 1px solid #bdc3c7; padding-right: 15px; }
        #canvas-container { position: relative; margin-top: 20px; background: white; line-height: 0; }
        #mangaPage { max-width: 900px; height: auto; display: none; }
        .text-overlay {
            position: absolute; cursor: move; padding: 5px; font-weight: bold; color: black;
            text-shadow: 2px 2px 0 #fff, -2px -2px 0 #fff, 2px -2px 0 #fff, -2px 2px 0 #fff;
            border: 1px dashed #3498db; line-height: 1.2; font-size: 18px; min-width: 50px; text-align: center;
            background: rgba(255,255,255,0.1);
        }
        button { cursor: pointer; padding: 8px 15px; border-radius: 4px; border: none; font-weight: bold; }
        .btn-add { background: #3498db; color: white; }
        .btn-export { background: #27ae60; color: white; }
    </style>
</head>
<body>

    <div class="toolbar">
        <div class="group">
            <input type="file" id="imageLoader" accept="image/*" multiple>
        </div>
        <div class="group">
            <button onclick="prevPage()">⬅️ Geri</button>
            <span id="pageInfo">Sayfa: 0 / 0</span>
            <button onclick="nextPage()">İleri ➡️</button>
        </div>
        <div class="group" style="border:none;">
            <button class="btn-add" onclick="addNewText()">+ Metin Ekle</button>
            <button class="btn-export" onclick="exportJSON()">JSON Al (F12)</button>
        </div>
    </div>
    
    <div id="canvas-container">
        <img id="mangaPage" src="">
    </div>

    <script>
        // JS BURADA
        let imageLoader = document.getElementById('imageLoader');
        let canvas = document.getElementById('canvas-container');
        let mangaPage = document.getElementById('mangaPage');
        let pageInfo = document.getElementById('pageInfo');
        let images = [];
        let currentIndex = 0;

        imageLoader.addEventListener('change', function(e) {
            images = Array.from(e.target.files);
            if (images.length > 0) {
                currentIndex = 0;
                showPage(currentIndex);
            }
        });

        function showPage(index) {
            document.querySelectorAll('.text-overlay').forEach(el => el.remove());
            let reader = new FileReader();
            reader.onload = function(event) {
                mangaPage.src = event.target.result;
                mangaPage.style.display = 'block';
                pageInfo.innerText = `Sayfa: ${index + 1} / ${images.length}`;
            }
            reader.readAsDataURL(images[index]);
        }

        function nextPage() { if (currentIndex < images.length - 1) { currentIndex++; showPage(currentIndex); } }
        function prevPage() { if (currentIndex > 0) { currentIndex--; showPage(currentIndex); } }

        // Metin Ekleme Fonksiyonu (Düzeltildi)
        function addNewText() {
            console.log("Metin ekleme tetiklendi"); // Çalıştığını konsoldan görelim
            let div = document.createElement('div');
            div.className = 'text-overlay';
            div.contentEditable = true;
            div.innerText = 'Çeviriyi yaz';
            div.style.left = '100px';
            div.style.top = '100px';

            div.onmousedown = function(e) {
                let shiftX = e.clientX - div.getBoundingClientRect().left;
                let shiftY = e.clientY - div.getBoundingClientRect().top;
                function moveAt(pageX, pageY) {
                    let rect = canvas.getBoundingClientRect();
                    div.style.left = (pageX - rect.left - shiftX) + 'px';
                    div.style.top = (pageY - rect.top - shiftY) + 'px';
                }
                function onMouseMove(e) { moveAt(e.pageX, e.pageY); }
                document.addEventListener('mousemove', onMouseMove);
                document.onmouseup = function() { document.removeEventListener('mousemove', onMouseMove); };
            };
            canvas.appendChild(div);
        }

        function exportJSON() {
            let overlays = document.querySelectorAll('.text-overlay');
            let data = [];
            overlays.forEach(el => {
                let x = (parseFloat(el.style.left) / mangaPage.clientWidth) * 100;
                let y = (parseFloat(el.style.top) / mangaPage.clientHeight) * 100;
                data.push({ text: el.innerText, x: x.toFixed(2) + "%", y: y.toFixed(2) + "%" });
            });
            console.log("KOPYALANACAK JSON:", JSON.stringify(data, null, 2));
            alert("Koordinatlar hazır! F12 tuşuna basıp 'Console' sekmesine bak.");
        }
    </script>
</body>
</html>